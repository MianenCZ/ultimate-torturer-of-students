<Window x:Class="UTS.WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:UTS.WPF"
        xmlns:convertors="clr-namespace:UTS.WPF.Convertors" 
        xmlns:mvvm="clr-namespace:UTS.WPF.MVVM" 
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
        Title="{DynamicResource AppTitle}"
        Width="1100" Height="700"
        >

    <Window.Resources>
        <convertors:CellStateToBrushConverter x:Key="CellStateToBrush"/>
        <convertors:CellStateToGlyphConverter x:Key="CellStateToGlyph"/>
    </Window.Resources>

    <Window.InputBindings>
        <KeyBinding Command="{Binding OpenCommand}"    Key="O" Modifiers="Control"/>
        <KeyBinding Command="{Binding SaveCommand}"    Key="S" Modifiers="Control"/>
        <KeyBinding Command="{Binding SaveAsCommand}"  Key="S" Modifiers="Control+Alt"/>
        <KeyBinding Command="{Binding NewCommand}"     Key="N" Modifiers="Control"/>
    </Window.InputBindings>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1*"/>
        </Grid.ColumnDefinitions>

        <Menu>
            <MenuItem Header="{DynamicResource MenuItem_File}">
                <MenuItem Header="{DynamicResource MenuItem_File_Open}" Command="{Binding OpenCommand}" InputGestureText="Ctrl+O"/>
                <MenuItem Header="{DynamicResource MenuItem_File_New}" Command="{Binding NewCommand}" InputGestureText="Ctrl+N"/>
                <MenuItem Header="{DynamicResource MenuItem_File_Save}" Command="{Binding SaveCommand}" InputGestureText="Ctrl+S"/>
                <MenuItem Header="{DynamicResource MenuItem_File_SaveAs}" Command="{Binding SaveAsCommand}" InputGestureText="Ctrl+Alt+S"/>
            </MenuItem>
            <MenuItem Header="{DynamicResource MenuItem_Settings}">
                <MenuItem Header="{DynamicResource MenuItem_Settings_Language}">
                    <MenuItem Header="English"
                              IsCheckable="True"
                              Command="{Binding SwitchLanguageCommand}"
                              CommandParameter="en-US">
                        <MenuItem.Style>
                            <Style TargetType="MenuItem">
                                <Setter Property="IsChecked" Value="False"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CurrentLocale}" Value="en-US">
                                        <Setter Property="IsChecked" Value="True"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </MenuItem.Style>
                    </MenuItem>

                    <MenuItem Header="Čeština"
                              IsCheckable="True"
                              Command="{Binding SwitchLanguageCommand}"
                              CommandParameter="cs-CZ">
                        <MenuItem.Style>
                            <Style TargetType="MenuItem">
                                <Setter Property="IsChecked" Value="False"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CurrentLocale}" Value="cs-CZ">
                                        <Setter Property="IsChecked" Value="True"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </MenuItem.Style>
                    </MenuItem>
                </MenuItem>
            </MenuItem>
        </Menu>
        
        <DataGrid x:Name="Grid"
              Grid.Column="0"
              ItemsSource="{Binding Document.Students}"
              AutoGenerateColumns="False"
              IsReadOnly="True"
              SelectionUnit="Cell"
              EnableRowVirtualization="True"
              EnableColumnVirtualization="True"
              VirtualizingPanel.IsVirtualizing="True"
              VirtualizingPanel.VirtualizationMode="Recycling"
              PreviewMouseLeftButtonDown="Grid_PreviewMouseLeftButtonDown"
              PreviewMouseRightButtonDown="Grid_PreviewMouseRightButtonDown"
              Margin="20">
            <DataGrid.Resources>
                <Style TargetType="DataGridCell">
                    <Setter Property="Padding" Value="0"/>
                    <Setter Property="BorderThickness" Value="0.5"/>
                    <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"/>
                    <!-- Preserve state colors by not forcing selection background -->
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                            <Setter Property="BorderThickness" Value="1"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.Resources>
        </DataGrid>
    </Grid>
</Window>
